<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto+Slab:700" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/2.6.2/phaser.js" integrity="sha256-/M28vKoYkkMS+oTf7FRKz2azs3TwYz7j7eeMGxMWiYg=" crossorigin="anonymous"></script>
    </head>

<body>
    <h1>js-game</h1>
    <p>
        This is a game written in javascript with <em>framework</em>
    </p>

    <script>
        var game = new Phaser.Game(800, 400, Phaser.AUTO, 'js-game', {
            preload: preload,
            create: create,
            update: update,
            render: render
        });

        function preload() {
            game.load.spritesheet('dude', 'assets/dude.png', 64, 64);
        }

        function create() {
            game.stage.backgroundColor = '#221122';
            game.stage.disableVisibilityChange = true;

            game.player = game.add.sprite(200, 200, 'dude', 6);
            game.player.anchor.setTo(0.5, 0.5);
            game.player.speed = 400; // px/s
            game.player.jumpspeed = -800;
            game.player.gravity = 2000; // px/s^2
            game.player.vel = {x: 0, y: 0};

            // one cycle should cover 50px, there are 6 frames
            // fps = velocity * distance-per-frame
            // fps = velocity * (frames / distance) * fudge-factor
            var fps = game.player.speed * (6 / 50) * 0.5;

            game.player.animations.add('run', [0,1,2,3,4,5], fps, true);
            game.player.animations.add('stand', [6], 0, true);
            game.player.animations.add('jump', [7], 0, true);
        }

        function update() {
            var t = game.time.elapsedMS;
            var p = game.player;

            if (p.x < 400 && p.y == 200 && game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR))
                p.vel.y = p.jumpspeed;

            p.vel.y += p.gravity * t / 1000;
            p.y += p.vel.y * t / 1000;

            if (p.x < 400 && p.y > 200){
                p.y = 200;
                p.vel.y = 0;
            }

            if (game.input.keyboard.isDown(Phaser.Keyboard.LEFT)
                && !game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)){

                p.vel.x = -p.speed * t / 1000;
                p.x += p.vel.x;
                p.scale.x = 1;

                if (p.x < 400 && p.y == 200)
                    p.play('run');
                else
                    p.play('jump');
            }
            else if (game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)
                     && !game.input.keyboard.isDown(Phaser.Keyboard.LEFT)){

                p.vel.x = p.speed * t / 1000;
                p.x += p.vel.x;
                p.scale.x = -1;

                if (p.x < 400 && p.y == 200)
                    p.play('run');
                else
                    p.play('jump');
            }
            else{
                p.play('stand');
            }
        }

        function render() {

        }

    </script>
    
    <p>
        More text!
    </p>
</body>

</html>
